KISSY.add("lib/photo-reply",function(a,b,c,d,e){function h(c){var d=(new Date).getTime();this.pid="dd-photo-reply"+d,this.idv="dd-photo-reply-value"+d,this.idImg="dd-photo-reply-img"+d,this.tpl=a.substitute(f,{id:this.pid,idv:this.idv}),this.pid="#"+this.pid,this.idv="#"+this.idv,this.$idImg="#"+this.idImg,this.target=b.get(c),this.init()}var f='<a href="#" class="dd-photo-reply" id="{id}"></a><input type="hidden" id="{idv}"/>',g='<img src="{src}" id="{id}"/>';return a.augment(h,{init:function(){this.render()},render:function(){var a=this,d=this.pid;this.target.innerHTML=this.tpl,this.getFileUpload(d,{width:b.width(d),height:b.height(d),over:function(){b.addClass(d,"on"),c.fire(a,"over")},out:function(){b.removeClass(d,"on"),c.fire(a,"out")}})},setValue:function(c,d){var e=this.pid,f=this.idv,h=this.$idImg,i=this.idImg;if(!c){b.get(e).innerHTML="",b.get(f).value="",b.removeClass(e,"selected");return}b.get(h)?b.get(h).src=d:b.get(e).innerHTML=a.substitute(g,{src:d,id:i}),b.addClass(e,"selected"),b.get(f).value=c},getValue:function(){var a=this.idv,c=b.get(a);return c?c.value:""},getFileUpload:function(a,c){var f=this,g=new d({clicker:a,title:"\u56fe\u7247\u56de\u5e94",clickerWidth:c.width,clickerHeight:c.height,useInputWrap:!0,allowFileTypes:"*.jpg;*.png;*.gif;*.jpeg;*.bmp",url:e.url.host+"/upload?imgsize=b25",zIndex:1e4});return g.guidEle=b.get("#dd-frameupload-form-"+g.guid),g.on("fileSelected",function(a){f.fileDialogCompleteHandler(a,g),(c.onstart||function(){})(a,g)}),g.on("mouseover",c.over||function(){}),g.on("mouseout",c.out||function(){}),g.on("uploadComplete",function(a){f.uploadCompleteHandler(a,g),(c.oncomplete||function(){})(a,g)}),g},fileDialogCompleteHandler:function(a,c){if(!a.data)return;c.startUpload(),b.hide(c.guidEle)},uploadCompleteHandler:function(a,c){b.show(c.guidEle),a.data.url?this.setValue(a.data.id,a.data.url):e.alert(a.data.result)}}),h},{requires:["dom","event","lib/frameupload.$7202","util.$7202"]});