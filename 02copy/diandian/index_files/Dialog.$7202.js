KISSY.add("sky/Dialog",function(a,b,c,d,e){return b.Dialog=function(a){this._type="dialog",this._autoState=0,b.Control.call(this,a),this.__initOption("autoPosition",null,"AUTO_POSITION"),this.__initOption("dragable",null,"DRAGABLE"),this.__initOption("closeButton",null,"CLOSE_BUTTON"),this.__initOption("width",null,"WIDTH"),this.__initOption("top",null,"TOP"),this._resizeHandler=this._getResizeHandler()},b.Dialog.prototype={render:function(){var a=this,c=a.getLayer(),e,f,g,h;if(c)return null;a.skin?h=a.skin+(a.dragable?"-dragable":""):h=a.dragable?"dragable":"",c=b.core.create("Layer",{id:a.__getId("layer"),retype:a._type,skin:h,width:a.width}),c.appendTo(),a._controlMap.layer=c,f=c.main,f.innerHTML=a._getMainHtml(),e=b.core.init(f),g=e[a.__getId("close")],g&&(c._controlMap.close=g,d.on(g,"click",a._getCloseHandler()))},appendTo:function(){this.render()},show:function(){var a=this,e=a.mask,f;a.getLayer()||a.render(),f=a.getLayer().main,a.autoPosition&&d.add(window,"resize",a._resizeHandler),a._resizeHandler(),a.dragable&&KISSY.use("dd",function(b,d){(new d.Draggable({node:f,handlers:[a.getHead()]})).on("drag",function(a){c.offset(f,{left:a.left,top:a.top})})}),e&&b.Mask.show(e.level,e.type),a.enterButtonId&&d.add(window,"keydown",a._getDefaultEnter,a),a._isShow=!0,a.fire("show")},hide:function(){var a=this;a._isShow&&(a.autoPosition&&d.remove(window,"resize",a._resizeHandler),a.enterButtonId&&d.remove(window,"keydown",a._getDefaultEnter),a.getLayer().hide(),a.mask&&b.Mask.hide(a.mask.level)),a._isShow=0,a.fire("hide")},getLayer:function(){return this._controlMap.layer},getBody:function(){return b.util.g(this.__getId("body"))},getHead:function(){return b.util.g(this.__getId("head"))},getFoot:function(){return b.util.g(this.__getId("foot"))},setContent:function(a){var b=this.getBody();b&&(b.innerHTML=a),this.content=a},setTitle:function(a){var d=this,e=b.util.g(d.__getId("title")),f=d.getHead();e&&(e.innerHTML=a,a&&a!==""?c.show(f):c.hide(f)),this.title=a},getCloseButton:function(){return this.getLayer()._controlMap.close},_getMainHtml:function(){var a=this,b=this.template||this._template,c="head",d="title",f="body",g="foot",h={headId:a.__getId(c),headClass:a.__getClass(c),titleId:a.__getId(d),titleClass:a.__getClass(d),bodyId:a.__getId(f),bodyClass:a.__getClass(f),footId:a.__getId(g),footClass:a.__getClass(g),closeBtnId:a.__getId("close"),headOverHandler:a.__getStrCall("_headOver"),headOutHandler:a.__getStrCall("_headOut"),closeButton:a.closeButton,title:a.title,content:a.content},i=e(b).render(h);return i},_getDefaultEnter:function(a){var c=this;keyCode=a.which,enterButton=b.get(c.enterButtonId),keyCode==13&&enterButton&&(enterButton.fire("click"),a.halt())},_headOver:function(){c.addClass(this.getHead(),this.__getClass("head-hover"))},_headOut:function(){c.removeClass(this.getHead(),this.__getClass("head-hover"))},_getResizeHandler:function(){var a=this;return function(){var b=a.getLayer(),d=b.main,e=a.left,f=a.top;e||(e=(c.viewportWidth()-d.offsetWidth)/2),f+=c.scrollTop(),e<0&&(e=0),f<0&&(f=0),b.show(e,f)}},_getCloseHandler:function(){var a=this;return function(b){a.hide()}},__createMain:function(){},__dispose:function(){this.autoPosition&&d.remove(window,"resize",this._resizeHandler),this.enterButtonId&&d.remove(window,"keydown",this._getDefaultEnter),this.getLayer().dispose(),this._resizeHandler=null,b.Control.prototype.__dispose.call(this)},_template:'<div id="{{headId}}" class="{{headClass}}"><div id="{{titleId}}" class="{{titleClass}}" onmouseover="{{headOverHandler}}" onmouseout="{{headOutHandler}}">{{title}}</div>{{#if closeButton}}<div cloud="type:Button;id:{{closeBtnId}};skin:layerclose"></div>{{/if}}</div><div id="{{bodyId}}" class="{{bodyClass}}">{{content}}</div><div id="{{footId}}" class="{{footClass}}"></div>'},b.util.inherits(b.Dialog,b.Control),b.core.register("Dialog",b.Dialog),b.Dialog.TOP=150,b.Dialog.WIDTH=400,b.Dialog.CLOSE_BUTTON=1,b.Dialog.OK_TEXT="\u786e\u5b9a",b.Dialog.CANCEL_TEXT="\u53d6\u6d88",b.Dialog.SKIN="willwhite",b.Dialog.OK_SKIN="willblue-lite",b.Dialog.CANCEL_SKIN="willlight-lite",b.Dialog.BUTTON_WIDTH=55,b.Dialog._increment=function(){var a=0;return function(){return a++}}(),b.Dialog.alert=function(){function e(e){if(!e)return;var f=b.Dialog._increment(),g=e.title||"",h=e.content||"",i=e.type||"info",j=e.skin||b.Dialog.SKIN,k=e.okskin||b.Dialog.OK_SKIN,l=e.okwidth||b.Dialog.BUTTON_WIDTH,m=e.onok,n='<div class="ui-dialog-icon ui-dialog-icon-{0}"></div><div class="ui-dialog-text">{1}</div>',o=b.create("Button",{id:d+f,skin:k,content:b.Dialog.OK_TEXT,width:l}),p=b.create("Dialog",{id:c+f,closeButton:b.Dialog.CLOSE_BUTTON,title:"",skin:j,width:b.Dialog.WIDTH,mask:{level:3}});return p.enterButtonId=o.id,p.show(),p.setTitle(g),p.getBody().innerHTML=b.util.format(n,i,h),o.on("click",function(c){(!a.isFunction(m)||m(p)!==!1)&&p&&(p.hide(),b.core.dispose(d+f),b.core.dispose(p.id),p=null)}),o.appendTo(p.getFoot()),p}var c="__DialogAlert",d="__DialogAlertOk";return e}(),b.Dialog.confirm=function(){function f(f){if(!f)return;var h=b.Dialog._increment(),i=f.title||"",j=f.content||"",k=f.type||"info",l=f.skin||b.Dialog.SKIN,m=f.width||b.Dialog.WIDTH,n=f.oncancel,o=f.onok,p=f.cancelskin||b.Dialog.CANCEL_SKIN,q=f.okskin||b.Dialog.OK_SKIN,r=f.okwidth||b.Dialog.BUTTON_WIDTH,s=f.cancelwidth||b.Dialog.BUTTON_WIDTH,t=f.oktext||b.Dialog.OK_TEXT,u=f.canceltext||b.Dialog.CANCEL_TEXT,v='<div class="ui-dialog-icon ui-dialog-icon-{0}"></div><div class="ui-dialog-text">{1}</div>',w=b.create("Button",{id:d+h,skin:q,content:t,width:r}),x=b.create("Button",{id:e+h,skin:p,content:u,width:s}),y=b.create("Dialog",{id:c+h,closeButton:b.Dialog.CLOSE_BUTTON,title:"",skin:l,width:m,mask:{level:f.level||3}});y.enterButtonId=w.id,y.show(),y.setTitle(i),y.getBody().innerHTML=b.util.format(v,k,j);var z=y.getFoot();w.appendTo(z),x.appendTo(z),b.init(y.getLayer().main),f.oninit&&a.isFunction(f.oninit)&&f.oninit(y),w.on("click",function(){g(o,h)}),x.on("click",function(){g(n,h)}),y.getCloseButton().on("click",function(){g(n,h)})}function g(f,g){var h=b.get(c+g);(!a.isFunction(f)||f(h)!==!1)&&h&&(h.hide(),b.core.dispose(d+g),b.core.dispose(e+g),b.core.dispose(h.id),h=null)}var c="__DialogConfirm",d="__DialogConfirmOk",e="__DialogConfirmCancel";return f}(),b.Dialog},{requires:["sky.$6939","dom","event","template"]});