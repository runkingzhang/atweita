KISSY.add("sky",function(a,b,c,d,e){return window.sky=window.sky||{version:"0.2.1"},sky.util=function(){function a(a,b,c){var d,e,f=a.prototype,g=function(){};g.prototype=b.prototype,e=a.prototype=new g;for(d in f)e[d]=f[d];a.prototype.constructor=a,a.superClass=b.prototype,"string"==typeof c&&(e._className=c)}function b(a,b){window.console!==undefined&&console.log&&console[b&&console[b]?b:"log"](a)}function c(a){return"string"==typeof a||a instanceof String?document.getElementById(a):a&&a.nodeName&&(a.nodeType==1||a.nodeType==9)?a:null}function d(a){return typeof a!="undefined"&&a!==null}function e(a,b){a=String(a);if("undefined"!=typeof b){if("[object Object]"==Object.prototype.toString.call(b))return a.replace(/\$\{(.+?)\}/g,function(a,c){var d=b[c];return"function"==typeof d&&(d=d(c)),"undefined"==typeof d?"":d});var c=Array.prototype.slice.call(arguments,1),d=c.length;return a.replace(/\{(\d+)\}/g,function(a,b){return b=parseInt(b,10),b>=d?a:c[b]})}return a}return{log:b,inherits:a,g:c,hasValue:d,format:e}}(),sky.core=function(){function e(a){return b[a]||null}function f(a){return c[a]||null}function g(b,c,d){var e=[],f;return a.each(b,function(a){f=a[c],d===f&&e.push(a)}),e}function h(a,b){b=b||{};var d=c[a]||sky[a],e=b.id,f=null;if(e&&d)f=new d(b),b.main&&f.render();else if(!d)return sky.util.log("Can't Find Component: "+a),null;return f}function i(b,c,d){c=c||{},b=a.get(b),b||sky.util.log("WARNING: init document.body","warn"),b=b||document.body;var e=b.getElementsByTagName("*"),f="cloud",g=[],h,i,j,k,m,n,o,p,q,r,s,t,u,v={};for(r=0,s=e.length;r<s;r++)g.push(e[r]);for(r=0,s=g.length;r<s;r++){u=g[r],i=u.getAttribute(f);if(i){h={},j=i.split(";"),k=j.length;while(k--){o=j[k];if(!o)continue;q=o.split(":"),m=q[0],n=q[1],h[m]=n}h.main=u;var w=h.id;w||(w=l(),h.id=w),p=c[w];for(t in p)h[t]=h[t]||p[t];"function"==typeof d&&d(h),v[w]=sky.core.create(h.type,h),u.setAttribute(f,"")}}return v}function j(c){a.mix(c,a.EventTarget),b[c.id]=c,c.__construct()}function k(a){if(a){var d=a,e;typeof a=="string"&&(d=b[a]),d&&d instanceof c.Control&&(e=d.id,d.__dispose(),delete b[e])}else for(var f in b)sky.core.dispose(f)}function l(){return"_innerui_"+d++}function m(a,b){c[a]=b}function n(a){if(!a)return null;var b;return(b=a.getAttribute("data-control"))?sky.core.get(b):null}function o(a){var b=a.getElementsByTagName("*"),c=b.length,d,e=[];while(c--)d=b[c].getAttribute("data-control"),d&&e.push(sky.core.get(d));return e}var b={},c={},d=0;return{get:e,getComponent:f,create:h,init:i,dispose:k,register:m,getControlsByContainer:o,getControlByDOM:n,construct:j,getGUID:l,controlsFilter:g}}(),c.add(window,"unload",sky.core.dispose),sky.log=sky.util.log,sky.get=sky.core.get,sky.init=sky.core.init,sky.create=sky.core.create,sky.dispose=sky.core.dispose,sky.Mask=function(){function d(a){var c=document.createElement("div");c.id=b+a,document.body.appendChild(c)}function e(a){var b=Math.max(document.documentElement.clientWidth,Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)),c=Math.max(document.documentElement.clientHeight,Math.max(document.body.scrollHeight,document.documentElement.scrollHeight));a.style.width=b+"px",a.style.height=c+"px"}function f(a){return function(){e(g(a))}}function g(a){var c=b+a,e=sky.util.g(c);return e||d(a),sky.util.g(c)}var a="ui-mask",b="ctrlMask",h={};return{show:function(b,d){b=b||"0";var i=g(b),j=[];j.push(a),j.push(a+"-level-"+b),d&&j.push(a+"-"+d),e(i),i.className=j.join(" "),i.style.display="block";var k=f(b);h[b]=k,c.add(window,"resize",k)},hide:function(a){a=a||"0";var b=g(a);if("undefined"!=typeof b){b.style.display="none";var d=h[a];c.remove(window,"resize",d)}},get:function(a){return g(a)}}}(),sky.Control=function(a){this._state={},this.__initOptions(a),this.id||(this.id=sky.core.getGUID()),sky.core.construct(this)},sky.Control.prototype={render:function(){var a=this.main;this._isRendered||(!a.id&&(a.id=this.__getId()),a.setAttribute("data-control",this.id),b.addClass(a,this.__getClass()),this._autoState&&this.__initStateChanger(),this.preclass&&b.removeClass(a,this.preclass),this._isRendered=!0)},appendTo:function(a){a=a||document.body,a.appendChild(this.main),this.render()},dispose:function(){sky.dispose(this)},disable:function(){this.addState("disabled"),this.disabled=!0},enable:function(){this.removeState("disabled"),this.disabled=!1},isDisabled:function(){return this.getState("disabled")},setDisabled:function(a){this[a?"disable":"enable"]()},addState:function(a){this._state[a]=1,b.addClass(this.main,this.__getClass(a))},removeState:function(a){delete this._state[a],b.removeClass(this.main,this.__getClass(a))},getState:function(a){return!!this._state[a]},__initStateChanger:function(){var a=this,b=a.main;a._state={},b&&(c.add(b,"mouseenter",a.__getMainEnterHandler,a),c.add(b,"mouseleave",a.__getMainLeaveHandler,a),c.add(b,"mousedown",a.__getMainDownHandler,a),c.add(b,"mouseup",a.__getMainUpHandler,a))},__getMainEnterHandler:function(){var a=this;a._state.disabled||a.addState("hover")},__getMainLeaveHandler:function(){var a=this;a._state.disabled||(a.removeState("hover"),a.removeState("press"))},__getMainDownHandler:function(){var a=this;a._state.disabled||a.addState("press")},__getMainUpHandler:function(){var a=this;a._state.disabled||a.removeState("press")},__getId:function(a){var b="ctrl"+this._type+this.id;return a?b+a:b},__getClass:function(a){var b=this,c=b._type.toLowerCase(),d="ui-"+c,e="skin-"+c+"-"+b.skin;return a&&(d+="-"+a,e+="-"+a),b.skin&&(d+=" "+e),d},__construct:function(){this.main||(this.main=this.__createMain()),this._controlMap={}},__createMain:function(){return document.createElement("div")},__initOptions:function(a){for(var b in a)this[b]=a[b]},__initOption:function(a,b,c){var d=sky.util.hasValue;d(this[a])||("string"==typeof c&&(this[a]=this.constructor[c]),!d(this[a])&&d(b)&&(this[a]=b))},__getStrRef:function(){return"sky.core.get('"+this.id+"')"},__getStrCall:function(a){var b=arguments.length,c=[],d,e;if(b>1)for(d=1;d<b;d++)e=arguments[d],typeof e=="string"&&(e="'"+e+"'"),c.push(e);return this.__getStrRef()+"."+a+"("+c.join(",")+");"},__dispose:function(){var a=this._controlMap,b=this.main;if(a)for(var d in a)sky.dispose(a[d].id),delete a[d];this._controlMap=null,b&&c.remove(b),this.main=null}},sky.core.register("Control",sky.Control),sky.Button=function(a){this._type="button",this._autoState=1,sky.Control.call(this,a)},sky.Button.prototype={render:function(){var a=this,b=a.main,d;a._isRendered||(d=b.firstChild,!a.content&&d&&d.tagName!="DIV"&&(a.content=b.innerHTML),sky.Control.prototype.render.call(a),a._repaint(),c.add(b,"click",a._getClickHandler,a),c.add(b,"mouseenter",a._getMouseEnterHandler,a),c.add(b,"mouseleave",a._getMouseLeaveHandler,a),a._isRendered=!0),a.setWidth(a.width),a.setActive(a.active),a.setDisabled(a.disabled)},setWidth:function(a){var b=this;b.width=a,b.main.style.width=b.width?b.width+"px":""},setContent:function(a){this.content=a||"",sky.util.g(this.__getId("text")).innerHTML=this.content},getContent:function(){return this.content},setActive:function(a){var b="active";a?this.addState(b):this.removeState(b)},setSkin:function(a){var b=this;b.skin=a||"",b._repaint()},_repaint:function(){var a=this,b=a.main;b.className=a.__getClass(),b.innerHTML=a._getMainHtml()},_getMainHtml:function(){var a=this,b=a.__getClass("label");return a.icon&&(b=b+" "+a.__getClass("label-"+a.icon)),sky.util.format(a._tplButton,a.content||"&nbsp;",b,a.__getId("label"),a.__getClass("text"),a.__getId("text"),a._getIconHtml(),a.__getClass("bg-left"))},_getIconHtml:function(){var a=this,b="";return a.icon&&(b=sky.util.format(a._tplIcon,a.__getClass("icon"))),b},_getClickHandler:function(a){var b=this;b.isDisabled()||(b.fire("click",{originEvent:a}),b.target=="_blank"&&b.href?window.open(b.href):b.href&&(location.href=b.href))},_getMouseEnterHandler:function(a){var b=this;b.isDisabled()||b.fire("mouseenter",{originEvent:a})},_getMouseLeaveHandler:function(a){var b=this;b.isDisabled()||b.fire("mouseleave",a)},__construct:function(){sky.Control.prototype.__construct.call(this);var a=this,b=a.main;a.href=a.href||b.getAttribute("href"),a.target=a.target||b.getAttribute("target")},_tplButton:'<span class="{6}"></span><div id="{2}" class="{1}">{5}<span id="{4}" class="{3}">{0}</span></div>',_tplIcon:'<span class="{0}"></span>'},sky.util.inherits(sky.Button,sky.Control),sky.core.register("Button",sky.Button),sky.Layer=function(a){sky.Control.call(this,a),this._type=this.retype||"layer",this._autoState=0,this.top=0,this.left=0,this.autoHide=this.autoHide||""},sky.Layer.prototype={render:function(){var a=this,b=a.main;sky.Control.prototype.render.call(this),b.style.position="absolute",b.style.top=a._HIDE_POS,b.style.left=a._HIDE_POS,a.zIndex&&(b.style.zIndex=a.zIndex),a.width&&(b.style.width=a.width+"px"),a.height&&(b.style.height=a.height+"px");if(this._autoHideInited)return null;switch(this.autoHide.toLowerCase()){case"click":c.add(document,"click",a._getClickHideHandler,a);break;case"out":c.add(b,"mouseenter",this._getEnterHandler,a),c.add(b,"mouseleave",this._getLeaveHandler,a)}this._autoHideInited=1},setWidth:function(a){this.main.style.width=a+"px",this.width=a},getWidth:function(){return this.width||this.main.offsetWidth},setHeight:function(a){this.main.style.height=a+"px",this.height=a},getHeight:function(){return this.height||this.main.offsetHeight},show:function(a,b){var c=this;c._isShow=1,c.left=a||c.left,c.top=b||c.top,c.main.style.left=c.left+"px",c.main.style.top=c.top+"px"},hide:function(){var a=this;a._isShow=0,b.css(a.main,"left",a._HIDE_POS),b.css(a.main,"top",a._HIDE_POS)},isShow:function(){return!!this._isShow},_getLeaveHandler:function(a){var b=this;b.fire("hide",{originEvent:a}),b.hide()},_getEnterHandler:function(){this.show()},_preventHide:function(){this._isHidePrevent=1},_getClickHideHandler:function(a){var b=this;if(b._isHidePrevent){b._isHidePrevent=0;return}var c=a.target;while(c&&c!=document.body){if(c==b.main)return;c=c.parentNode}b.fire("hide",{originEvent:a}),b.hide()},__dispose:function(){var a=this,b=a.main;c.remove(document,"click",a._getClickHideHandler),sky.Control.prototype.__dispose.call(a),a.innerHTML="",b.parentNode&&b.parentNode.removeChild(b)},_HIDE_POS:"-10000px"},sky.util.inherits(sky.Layer,sky.Control),sky.core.register("Layer",sky.Layer),sky.InputControl=function(a){sky.Control.call(this,a)},sky.InputControl.prototype={render:function(){this.name=this.main.getAttribute("name"),sky.Control.prototype.render.call(this)},getName:function(){return this.name},getValue:function(){return this.value},setValue:function(a){this.value=a},__createInput:function(a){var b=a.tagName,c=a.name,d=a.type,e=b,f;return c&&(e="<"+b+' name="'+this.name+'">'),f=document.createElement(e),f||(f=document.createElement(b),c&&(f.name=c)),d&&(f.type=d),f}},sky.util.inherits(sky.InputControl,sky.Control),sky.core.register("InputControl",sky.InputControl),sky.BoxControl=function(a){this._autoState=1,sky.InputControl.call(this,a)},sky.BoxControl.prototype={getType:function(){return this._type},setChecked:function(a){this.main.checked=!!a},isChecked:function(){return this.main.checked},disable:function(){this.main.disabled=!0,this.disabled=!0,sky.InputControl.prototype.disable.call(this)},enable:function(){this.main.disabled=!1,this.disabled=!1,sky.InputControl.prototype.enable.call(this)},setReadOnly:function(a){this.main.disabled=a,a?this.addState("readonly"):this.removeState("readonly")},getGroup:function(){var a=sky.core.getComponent("BoxGroup");return new a({name:this.name,type:this._type,control:this})},setValue:function(a){this.main.setAttribute("value",a)},getValue:function(){return this.main.getAttribute("value")||"on"},setTitle:function(b){var c=this,d=c.main;c.title=b,d.title=b,c._label.innerHTML=a.escapeHTML(b)},getTitle:function(){return this.title},render:function(){var d=this,e=d.main,f=d.datasource,g,h,i;sky.InputControl.prototype.render.call(d),c.add(e,"click",d.__getClickHandler,d),d._label||(h=document.createElement("label"),h.className=d.__getClass("label"),h.setAttribute("for",e.id),b.insertAfter(h,e),d._label=h),g=d.title||e.title||"",d.setTitle(g),d.setDisabled(!!d.disabled),d.value&&d.setValue(d.value),i=d.getValue();switch(typeof f){case"string":case"number":d.setChecked(f==i);break;default:f instanceof Array&&d.setChecked(a.inArray(f,i))}},__getClickHandler:function(a){var b=this;b.isDisabled()||(b.fire("click",{originEvent:a}),b.onclick(a,b))},__dispose:function(){this.onclick=null,this._label=null,sky.InputControl.prototype.__dispose.call(this)},__createMain:function(){return sky.InputControl.prototype.__createInput.call(this,{tagName:"input",name:this.name,type:this.type})},onclick:function(){}},sky.util.inherits(sky.BoxControl,sky.InputControl),sky.core.register("BoxControl",sky.BoxControl),sky.CheckBox=function(a){this._type="checkbox",sky.BoxControl.call(this,a)},sky.util.inherits(sky.CheckBox,sky.BoxControl),sky.core.register("CheckBox",sky.CheckBox),sky.Radio=function(a){this._type="radiobox",sky.BoxControl.call(this,a)},sky.util.inherits(sky.Radio,sky.BoxControl),sky.core.register("Radio",sky.Radio),sky.BoxGroup=function(a){this.name=a.name,this.type=a.type,this.control=a.control},sky.BoxGroup.prototype={getValue:function(){var a=this,b=a.getBoxList(),c=b.length,d=[],e=0,f;for(;e<c;e++)f=b[e],f.isChecked()&&d.push(f.getValue());return d.join(",")},selectAll:function(){if(this.type!="checkbox")return;var a=this.getBoxList(),b=a.length,c=0;for(;c<b;c++)a[c].setChecked(!0)},selectInverse:function(){if(this.type!="checkbox")return;var a=this.getBoxList(),b=a.length,c=0,d;for(;c<b;c++)d=a[c],d.setChecked(!d.isChecked())},getBoxList:function(){var a=this,b=a.name,c=a.type,d=[],e=a.control.main,f,g,h,i,j,k=sky.core.getComponent("BoxControl");while(e&&e.tagName!="FORM"&&e!=document.body)e=e.parentNode;f=e.getElementsByTagName("input"),i=f.length;for(g=0;g<i;g++)h=f[g],j=sky.core.getControlByDOM(h),j&&j instanceof k&&j.getType()==c&&j.name==b&&d.push(j);return d}},sky.core.register("BoxGroup",sky.BoxGroup),sky.TextInput=function(a){this._autoState=1,this.fold=1,sky.InputControl.call(this,a),this._commandKey=!1,this.value=this.value||"",this.mode&&this.mode!="textarea"&&this.mode!="password"&&(this.mode="text")},sky.TextInput.prototype={render:function(){var a=this,b=a.main;a._isRendered||(sky.InputControl.prototype.render.call(a),c.add(b,"keydown keyup",function(b){var c=b.keyCode;if(224===c||91===c||93===c)a._commandKey="keydown"===b.type}),c.add(b,"keydown",a._getDownHandler,a),a._addInputListener(),c.remove(b,"mousedown"),c.remove(b,"mouseup"),c.add(b,"focus",a._getFocusHandler,a),c.add(b,"blur",a._getBlurHandler,a),a.autogrow&&(a._autoGrowRefresh=a._autoGrow()),a._isRendered=1),a.setReadOnly(!!a.readOnly),a.setDisabled(!!a.disabled),a.setWidth(a.width),a.setHeight(a.height),a.setValue(a.value)},enable:function(){this.main.disabled=!1,sky.InputControl.prototype.enable.call(this)},disable:function(){this.main.disabled=!0,sky.InputControl.prototype.disable.call(this)},setReadOnly:function(a){a=!!a,this.main.readOnly=a,this.readOnly=a,a?this.addState("readonly"):this.removeState("readonly")},setAutoGrowStatus:function(a){var b=this;b.autogrow&&(b._disableAutoGrow=!a)},setWidth:function(a){a&&(this.width=a,this.main.style.width=a+"px")},select:function(){this.main.select()},setHeight:function(a){a&&(this.height=a,this.main.style.height=a+"px")},setValue:function(a){a=a||"";var c=this,d=c.main,e=c.__getClass("virtual"),f=c.placeholder;this._removeInputListener(),d.value=a,a?(c._placing=0,b.removeClass(d,e)):f&&(c._placing=1,d.value=f,b.addClass(d,e)),this._addInputListener()},setPlaceholder:function(a){var b=this,a=a||null;b.placeholder=a,b.setValue(b.getValue())},getValue:function(){var a=this,b=a.main.value;return a._placing?"":b},resetAutoGrow:function(){var a=this;a.autogrow&&a._autoGrowRefresh(1)},_addInputListener:function(){var a=this,b=a.main;c.add(b,"valuechange",a._getChangeHandler,a)},_removeInputListener:function(){var a=this,b=a.main;c.remove(b,"valuechange")},_getChangeHandler:function(a){var b=this;b.fire("change",{originEvent:a})},_getFocusHandler:function(a){var c=this,d=c.main;b.removeClass(d,c.__getClass("virtual")),b.addClass(d,c.__getClass("focus")),c._placing&&(d.value="",c._placing=0),c.autoSelect&&d.select(),c.autogrow&&c._autoGrowRefresh(),c.fire("focus",{originEvent:a})},_getBlurHandler:function(a){var c=this,d=c.main;b.removeClass(d,c.__getClass("focus")),c.autogrow&&c.fold==1&&c.resetAutoGrow(),c.setValue(d.value),c.fire("blur",{originEvent:a})},_getDownHandler:function(a){var b=this,c=a.which;b._autoGrowRefresh&&b._autoGrowRefresh();if((a.ctrlKey||b._commandKey)&&c==13)return b.fire("ctrlenter",{originEvent:a}),!1;c==13&&b._type=="text"&&b.fire("enter",{originEvent:a})},_updateAutoGrow:function(){var a=this.main,c,d,e,f=0,g="dd-textarea-shadow",h="#"+g;if(!this.shadow){var i=b.clone(a);i.id=g,i.value="";var j={position:"absolute",left:-1e4,top:-1e4};b.css(i,j),b.insertAfter(i,a),this.shadow=b.get(h),d=b.height(a),this.shadow.scrollHeight,c=this.shadow.scrollHeight!==d,c&&(e=b.innerHeight(this.shadow),f=e-d),b.data(h,"offset",f)}return b.css(this.shadow,{width:b.width(a)}),f=b.data(h,"offset"),b.val(h,b.val(a)+this.autogrowSuffix),this.shadow.scrollHeight,this.shadow.scrollHeight-f},_autoGrow:function(){function g(e){d||(d=b.height(c)),a.timer=setTimeout(function(){if(a._disableAutoGrow)return;var g=Math.max(e||a._updateAutoGrow(c),d);f!=g&&(b.css(c,"height",g),f=g,a.fire("heightchanged"))})}var a=this,c=a.main,d,e=b.css,f;return g},__construct:function(){sky.InputControl.prototype.__construct.call(this);var a=this,b=a.main,c=b.tagName,d=b.getAttribute("type"),e="";switch(c){case"TEXTAREA":e="textarea";break;case"INPUT":switch(d){case"text":case"password":e=d}}if(!e)throw new Error("TextInput: invalid main element!");a.mode=a.mode||e,a._type=a.mode=="textarea"?"textarea":"text",a.value=a.value||b.value,a.placeholder=a.placeholder||b.getAttribute("placeholder"),b.setAttribute("placeholder",""),a.placeholder==a.value&&(a.value="")},__createMain:function(){var a=sky.InputControl.prototype.__createInput,b=this.mode;return b=b||"text",b=="text"||b=="password"?a.call(this,{tagName:"input",name:this.name,type:b}):a.call(this,{tagName:"textarea",name:this.name})}},sky.util.inherits(sky.TextInput,sky.InputControl),sky.core.register("TextInput",sky.TextInput),sky.Select=function(a){this._type="select",this._autoState=1,sky.InputControl.call(this,a),this.datasource=this.datasource||[]},sky.Select.prototype={render:function(){var a=this,b=a.main;a._isRendered||(sky.InputControl.prototype.render.call(a),a._repaint()),a.disabled&&a.setDisabled(a.disabled),a.value&&a.setValue(a.value),a.multiple&&a.setMultiple(a.multiple),c.add(b,"change",a._getChangeHandler,a),c.add(b,"blur",a._getBlurHandler,a),c.add(b,"focus",a._getFocusHandler,a)},_getChangeHandler:function(a){var b=this;a.value=b.getValue(),b.fire("change",{originEvent:a})},_getBlurHandler:function(a){this.fire("blur",{originEvent:a})},_getFocusHandler:function(a){this.fire("focus",{originEvent:a})},setDisabled:function(a){var b=this,c=b.main;sky.InputControl.prototype.setDisabled.call(b,a),a?c.setAttribute("disabled","disabled"):c.removeAttribute("disabled")},setMultiple:function(a){var b=this,c=b.main;a?c.setAttribute("multiple","multiple"):c.removeAttribute("multiple"),b.multiple=!!a},getValue:function(){return this.main.value},setValue:function(a){this.main.value=a,this.value=a},_repaint:function(){var a=this,b=a.main,c=a._getHtml();b.innerHTML=c},_getHtml:function(){function e(c){var f=[];return a.each(c,function(c){c.child&&a.isArray(c.child)?f.push(d(b._tplOptGroup).render({item:c,content:e(c.child)})):f.push(d(b._tplOption).render({item:c}))}),f.join("")}var b=this,c=b.datasource;return e(c)},__createMain:function(){var a=this;return b.create(d(a._tplSelect).render({data:{multiple:a.multiple,disabled:a.disabled}}))},_tplSelect:'<select{{#if data.multiple}} multiple="multiple"{{/if}}{{#if data.disabled}} disabled="disabled"{{/if}}></select>',_tplOption:'<option{{#if item.disabled}} disabled="disabled"{{/if}}{{#if item.title}} title="{{item.title}}"{{/if}}{{#if item.value}} value="{{item.value}}"{{/if}}{{#if item.selected}} selected="selected"{{/if}}>{{item.label}}</option>',_tplOptGroup:'<optgroup{{#if item.label}} label="{{item.label}}"{{/if}}{{#if item.title}} title="{{item.title}}"{{/if}}{{#if item.disabled}} disabled="disabled"{{/if}}>{{content}}</optgroup>'},sky.util.inherits(sky.Select,sky.InputControl),sky.core.register("Select",sky.Select),sky.Label=function(a){this._type="label",this._autoState=1,sky.Control.call(this,a)},sky.Label.prototype={render:function(){var b=this,c=this.main;b._isRendered||(!b.text&&!b.content&&c.firstChild&&(b.content=c.innerHTML),sky.Control.prototype.render.call(b),b._isRendered=!0),b.text&&(this.content=a.escapeHTML(this.text)),b.setContent(b.content),b.setTitle(b.title)},setContent:function(a){this.content=a||"",this.main.innerHTML=this.content},setText:function(b){b=b||"",this.setContent(a.escapeHTML(b))},setTitle:function(a){this.title=a||"",this.main.setAttribute("title",this.title)},__createMain:function(){return document.createElement("label")}},sky.util.inherits(sky.Label,sky.Control),sky.core.register("Label",sky.Label),sky.Link=function(a){this._type="link",this._autoState=0,sky.Control.call(this,a)},sky.Link.prototype={render:function(){var a=this;sky.Control.prototype.render.call(a),a.href&&a.setHref(a.href),a.text&&a.setText(a.text),a.content&&a.setContent(a.content),a.target&&a.setTarget(a.target),c.add(a.main,"click",a._getClickHandler,a)},setHref:function(a){!a&&(a=""),me.main.href=a},setText:function(b){!b&&(b=""),this.setContent(a.escapeHTML(b))},setContent:function(a){!a&&(a=""),this.main.innerHTML=a},setTarget:function(a){!a&&(a=""),this.main.target=a},_getClickHandler:function(a){me.fire("click",{originEvent:a})},__createMain:function(){return document.createElement("a")}},sky.util.inherits(sky.Link,sky.Control),sky.core.register("Link",sky.Link),sky.ComboBox=function(a){this._type="combobox",this._autoState=1,sky.InputControl.call(this,a),this.__initOption("maxItem",null,"MAX_ITEM"),this.__initOption("emptyText",null,"EMPTY_TEXT"),this.emptyLabel=sky.util.format(this._tplLabel,this.__getClass("text-def"),this.emptyText),this.datasource=this.datasource||[]},sky.ComboBox.EMPTY_TEXT="\u8bf7\u9009\u62e9",sky.ComboBox.MAX_ITEM=null,sky.ComboBox.prototype={disable:function(){this.hideLayer(),sky.InputControl.prototype.disable.call(this)},enable:function(){this.hideLayer(),sky.InputControl.prototype.enable.call(this)},setReadOnly:function(a){this.readOnly=a=!!a,a?this.addState("readonly"):this.removeState("readonly")},render:function(){var a=this,b=a.main,d=a.value;a._isRendered||(sky.InputControl.prototype.render.call(a),b.innerHTML=a._getMainHtml(),c.add(b,"click",a._getMainClickHandler,a),a._isRendered=1),a._renderLayer(),a.width&&(b.style.width=a.width+"px",a.getLayer().setWidth(a.width)),!a.value&&sky.util.hasValue(a.selectedIndex)?a.setSelectedIndex(a.selectedIndex):a.setValue(d),a.setReadOnly(!!a.readOnly),a.setDisabled(!!a.disabled),a.fire("renderafter")},showLayer:function(){var a=this,c=a.main,d=b.offset(c),e=a.getLayer(),f=e.main,g=f.offsetHeight,h=c.offsetHeight,i=b.viewportHeight(),j=d.top+h+g-b.scrollTop(),k;a.autoOffset!="1"||i>j?k=d.top+h-1:k=d.top-g+1,e.show(d.left,k),a.addState("active")},hideLayer:function(){this.getLayer().hide(),this.removeState("active")},toggleLayer:function(){var a=this;a.getLayer().isShow()?a.hideLayer():a.showLayer()},getLayer:function(){return this._controlMap.layer},getValue:function(){return sky.util.hasValue(this.value)?String(this.value):""},getOptions:function(){return this.datasource},addOption:function(a,b){var c=b?a.value:this.getValue();this.datasource.push(a),this.render(),this.setValue(c)},clearOptions:function(){this.datasource=[],this.render()},setValue:function(a){var c=this,d=c.getLayer().main,e=b.query(".ui-combobox-item",d),f,g,h,a=""+a;if(a)for(g=0,f=e.length;g<f;g++){h=e[g].getAttribute("value");if(h==a){c.setSelectedIndex(g);return}}c.value=null,c.setSelectedIndex(-1)},setSelectedIndex:function(a,b){var c=this,d=c.datasource[a],e;d?e=d.value:e=null,c.selectedIndex=a,c.value=e;if(b===!0){c.fire("change",{value:e,selected:d});if(c.halt===!0)return delete c.halt,!1}c._repaint(),b===!0&&c.fire("changeafter",{value:e,selected:d})},setWidth:function(a){var b=this;a&&(b.main.style.width=a+"px",b.getLayer().setWidth(a),b.width=a)},setStaticText:function(a){this.staticText=a,this._repaint()},setStaticIcon:function(a){this.staticIcon=a,this._repaint()},_getCur:function(){return sky.util.g(this.__getId("text"))},_repaint:function(){var a=this,b=a.datasource[a.selectedIndex],c,d,e="",f=a._getCur();a.staticText||a.staticIcon?(c=a.staticText||"",d=a.staticIcon||""):(c=b?b.name:a.emptyLabel,d=b?b.icon:""),d&&(e=sky.util.format(a._tplIcon,a.__getClass("icon-"+d))),f.innerHTML=e+"<nobr>"+c+"</nobr>",this._repaintLayer()},_repaintLayer:function(){var a=this,c=a.selectedIndex,d=a.getLayer().main.firstChild,e=a.__getClass("item-selected");while(d)d.getAttribute("index")==c?b.addClass(d,e):b.removeClass(d,e),d=d.nextSibling},_itemClickHandler:function(a){var b=a.getAttribute("index"),c=a.getAttribute("dis");if(c==1)return;this.hideLayer(),this.setSelectedIndex(parseInt(b,10),!0)},_itemOverHandler:function(a){if(a.getAttribute("dis")==1)return;b.addClass(a,this.__getClass("item-hover"))},_itemOutHandler:function(a){b.removeClass(a,this.__getClass("item-hover"))},_getMainHtml:function(){var a=this;return sky.util.format(a._tplMain,a.__getId("text"),a.__getClass("text"),a.staticText||a.emptyLabel,a.__getClass("arrow"))},_renderLayer:function(){var a=this,d=a.__getId("layer"),e=a.getLayer(),f=a.datasource.length,g=a.maxItem,h,i,j,k;e||(e=sky.core.create("Layer",{id:d,autoHide:"click",retype:"combobox-layer",skin:a.skin}),e.appendTo(),a._controlMap.layer=e,c.on(e,"hide",a._getLayerHideHandler())),h=e.main,h.style.width="auto",h.style.height="auto",h.innerHTML="<div class='select-content-i'>"+a._getLayerHtml()+"</div>",i=h.offsetWidth,j=h.offsetHeight,g&&f>g&&(k=h.firstChild.offsetHeight,h.style.height=g*(k+1)+"px",i+=17),i<a.width?e.setWidth(a.width):!!a.width&&e.setWidth(i),a.enableScroll&&KISSY.use("sky/Scroller.$6939",function(){var d=sky.create("Scroller",{id:"#Scroll",height:a.height,innerel:".select-content-i",main:h,skin:"comobox-scroll-bar"});c.on(d,"onscroll",function(a){var c=d.maxHeight;b.css(d.innerEl,{top:-a.value*c})})}),a._resizeHandler=a._getResizeHandler(),c.add(window,"resize",a._resizeHandler)},_getResizeHandler:function(){var a=this;return function(){a.getLayer().isShow()&&a.showLayer()}},_getLayerHideHandler:function(){var a=this;return function(){a.removeState("active")}},_getLayerHtml:function(){var a=this,b=a.datasource,c=0,d=b.length,e=[],f=a.__getStrRef(),g=a.__getClass("item"),h,i,j,k,l;for(;c<d;c++)h=g,i=0,j=b[c],l="",j.icon&&(k=a.__getClass("icon-"+j.icon),l=sky.util.format(a._tplIcon,k)),j.style&&(h+=" "+g+"-"+j.style),j.disabled&&(i=1,h+=" "+g+"-disabled"),j.value==a.value&&(h+=" "+a.__getClass("item-selected")),e.push(sky.util.format(a._tplItem,a.__getId("item")+c,h,c,j.value,i,j.name,f+"._itemOverHandler(this)",f+"._itemOutHandler(this)",f+"._itemClickHandler(this)",l));return e.join("")},_getMainClickHandler:function(a){var b=this,c=a.target;!b.readOnly&&!b.isDisabled()&&(c.getAttribute("arrow")||b.fire("mainclick",{originEvent:a}),b.halt!==!0?(b.getLayer()._preventHide(),b.toggleLayer()):delete b.halt)},__construct:function(){sky.InputControl.prototype.__construct.call(this);var a=this,b=a.main;a.staticIcon=a.staticIcon||b.getAttribute("staticIcon"),a.staticText=a.staticText||b.getAttribute("staticText")},__dispose:function(){var a=this;c.remove(window,"resize",a._resizeHandler),a._resizeHandler=null,sky.InputControl.prototype.__dispose.call(a)},_tplMain:'<div id="{0}" class="{1}" value=""><nobr>{2}</nobr></div><div class="{3}" arrow="1"></div>',_tplLabel:'<span class="{0}">{1}</span>',_tplItem:'<div id="{0}" class="{1}" index="{2}" value="{3}" dis="{4}" onmouseover="{6}" onmouseout="{7}" onclick="{8}">{9}<nobr>{5}</nobr></div>',_tplIcon:'<span class="{0}"></span>'},sky.util.inherits(sky.ComboBox,sky.InputControl),sky.core.register("ComboBox",sky.ComboBox),sky},{requires:["dom","event","template","anim"]});